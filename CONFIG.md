# 配置说明

## 环境变量配置

在项目根目录创建 `.env.local` 文件，包含以下配置：

### Cloudflare R2 配置
```bash
CLOUDFLARE_R2_ACCESS_KEY_ID=your_access_key_id_here
CLOUDFLARE_R2_SECRET_ACCESS_KEY=your_secret_access_key_here
CLOUDFLARE_R2_BUCKET_NAME=your_bucket_name_here
CLOUDFLARE_R2_ACCOUNT_ID=your_account_id_here
```

### Supabase 配置
```bash
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key_here
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url_here
```

## 获取配置值

### Cloudflare R2
1. 登录 [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. 进入 R2 存储服务
3. 创建新的 R2 存储桶
4. 在 API Tokens 中创建新的 API 密钥
5. 记录 Access Key ID 和 Secret Access Key
6. 记录 Account ID 和 Bucket Name

### Supabase
1. 登录 [Supabase Dashboard](https://supabase.com/dashboard)
2. 创建新项目或使用现有项目
3. 在 Settings > API 中找到项目 URL 和 anon key
4. 在 SQL Editor 中执行数据库表创建语句

## 数据库表创建

在 Supabase SQL Editor 中执行：

```sql
create table public.ffmpeg_on_vercel_test (
  id bigint generated by default as identity not null,
  video_url text null,
  watermark_video_url text null,
  created_at timestamp with time zone not null default now(),
  updated_at timestamp with time zone null default now(),
  watermark_url text null,
  status text null,
  error_message text null,
  constraint ffmpeg_on_vercel_test_pkey primary key (id)
) TABLESPACE pg_default;
```

## 权限设置

### Cloudflare R2
确保 R2 存储桶具有以下权限：
- 读取权限：公开
- 写入权限：仅限认证用户

### Supabase
确保表具有以下权限：
- 插入权限：认证用户
- 更新权限：认证用户
- 读取权限：认证用户

## 测试配置

配置完成后，可以访问 `/test` 页面来测试：
- 水印API功能
- Supabase连接状态

## 常见问题

1. **环境变量未生效**: 重启开发服务器
2. **权限错误**: 检查API密钥和存储桶权限
3. **连接失败**: 验证网络连接和防火墙设置
