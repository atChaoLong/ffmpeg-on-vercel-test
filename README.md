# ğŸ¬ è§†é¢‘å¤„ç†å·¥å…·

ä¸€ä¸ªåŸºäº Next.js 15 çš„ä¸“ä¸šè§†é¢‘å¤„ç†å·¥å…·ï¼Œæ”¯æŒè§†é¢‘ä¸Šä¼ ã€æ°´å°æ·»åŠ å’Œæ ¼å¼è½¬æ¢åŠŸèƒ½ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

### ğŸ“¤ è§†é¢‘ä¸Šä¼ 
- æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼ï¼ˆMP4, WebM, AVI ç­‰ï¼‰
- è‡ªåŠ¨ä¸Šä¼ åˆ° Cloudflare R2 å­˜å‚¨
- æ–‡ä»¶é‡å‘½åä¸º UUID æ ¼å¼ï¼Œé¿å…å†²çª
- å®æ—¶ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- è‡ªåŠ¨æ°´å°å¤„ç†æµç¨‹

### ğŸ·ï¸ æ°´å°æ·»åŠ 
- 7ç§AIå·¥å…·å“ç‰Œæ°´å°é€‰æ‹©
- 5ç§ä½ç½®é€‰æ‹©ï¼ˆå››è§’+å±…ä¸­ï¼‰
- é€æ˜åº¦è°ƒèŠ‚ï¼ˆ10%-100%ï¼‰
- 3ç§å¤§å°è§„æ ¼ï¼ˆå°ã€ä¸­ã€å¤§ï¼‰
- å®æ—¶é¢„è§ˆè®¾ç½®æ•ˆæœ

### ğŸ”„ æ ¼å¼è½¬æ¢
- æ”¯æŒ WebM å’Œ MP4 æ ¼å¼
- 3ç§è´¨é‡ç­‰çº§é€‰æ‹©
- VP9/H.264 è§†é¢‘ç¼–ç 
- Opus/AAC éŸ³é¢‘ç¼–ç 
- æµå¼å¤„ç†ï¼Œå¿«é€Ÿä¸‹è½½

## ğŸš€ æŠ€æœ¯æ¶æ„

- **å‰ç«¯**: Next.js 15 + React 19 + TypeScript + Tailwind CSS
- **å­˜å‚¨**: Cloudflare R2 (S3 å…¼å®¹)
- **æ•°æ®åº“**: Supabase (PostgreSQL)
- **è§†é¢‘å¤„ç†**: FFmpeg
- **éƒ¨ç½²**: Vercel

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

- Node.js 18+
- FFmpeg (é€šè¿‡ ffmpeg-static åŒ…æä¾›)

## ğŸ”§ å®‰è£…å’Œé…ç½®

1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd ffmpeg-on-vercel-test
```

2. å®‰è£…ä¾èµ–
```bash
npm install
```

3. é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `.env.local` æ–‡ä»¶å¹¶æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```env
# Supabase é…ç½®
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# Cloudflare R2 é…ç½®
CLOUDFLARE_R2_ACCESS_KEY_ID=your_r2_access_key_id
CLOUDFLARE_R2_SECRET_ACCESS_KEY=your_r2_secret_access_key
CLOUDFLARE_R2_BUCKET_NAME=your_r2_bucket_name
CLOUDFLARE_R2_ACCOUNT_ID=your_r2_account_id
```

4. é…ç½® Supabase æ•°æ®åº“
æ‰§è¡Œä»¥ä¸‹ SQL åˆ›å»ºè¡¨ï¼š

```sql
create table public.ffmpeg_on_vercel_test (
  id bigint generated by default as identity not null,
  video_url text null,
  watermark_video_url text null,
  created_at timestamp with time zone not null default now(),
  updated_at timestamp with time zone null default now(),
  watermark_url text null,
  status text null,
  error_message text null,
  constraint ffmpeg_on_vercel_test_pkey primary key (id)
) TABLESPACE pg_default;
```

5. è¿è¡Œå¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
app/
â”œâ”€â”€ api/                    # API è·¯ç”±
â”‚   â”œâ”€â”€ upload/            # è§†é¢‘ä¸Šä¼ 
â”‚   â”œâ”€â”€ watermark/         # æ°´å°å¤„ç†
â”‚   â””â”€â”€ status/[id]/       # çŠ¶æ€æŸ¥è¯¢
â”œâ”€â”€ lib/                   # å·¥å…·åº“
â”‚   â”œâ”€â”€ supabase.js        # Supabase å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ r2-client.ts       # R2 å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ types.ts           # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ hooks/             # è‡ªå®šä¹‰ Hooks
â”‚       â””â”€â”€ useVideoProcessing.ts
â”œâ”€â”€ page.tsx               # ä¸»é¡µé¢
â””â”€â”€ layout.tsx             # å¸ƒå±€ç»„ä»¶
```

## ğŸ”„ å·¥ä½œæµç¨‹

1. **è§†é¢‘ä¸Šä¼ **: ç”¨æˆ·é€‰æ‹©è§†é¢‘æ–‡ä»¶ï¼Œç³»ç»Ÿè‡ªåŠ¨ä¸Šä¼ åˆ° R2 å­˜å‚¨
2. **æ°´å°å¤„ç†**: ä½¿ç”¨ FFmpeg å¤„ç†æ·»åŠ æ°´å°ï¼Œæ”¯æŒä½ç½®ã€é€æ˜åº¦ã€å¤§å°è°ƒèŠ‚
3. **ç»“æœä¿å­˜**: å¤„ç†å®Œæˆåçš„è§†é¢‘è‡ªåŠ¨ä¸Šä¼ åˆ° R2 å­˜å‚¨
4. **æ•°æ®åº“æ›´æ–°**: æ°´å°è§†é¢‘é“¾æ¥ä¿å­˜åˆ° Supabase æ•°æ®åº“
5. **çŠ¶æ€è·Ÿè¸ª**: å®æ—¶æŸ¥è¯¢å¤„ç†çŠ¶æ€ï¼Œæ”¯æŒé”™è¯¯å¤„ç†å’Œé‡è¯•
6. **ç»“æœè®¿é—®**: é€šè¿‡ R2 é“¾æ¥ç›´æ¥è®¿é—®æˆ–ä¸‹è½½æ°´å°è§†é¢‘

## ğŸ·ï¸ æ°´å°å¤„ç†æ–¹å¼

### ç°æœ‰æ¥å£ (`/api/video/watermark`)
- **è¯·æ±‚æ–¹å¼**: GET
- **å‚æ•°**: é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’
- **å¤„ç†æ–¹å¼**: æµå¼å¤„ç†ï¼Œç›´æ¥è¿”å›å¤„ç†åçš„è§†é¢‘æµ
- **é€‚ç”¨åœºæ™¯**: å®æ—¶æ°´å°å¤„ç†ï¼Œæ— éœ€ä¿å­˜åˆ°å­˜å‚¨

### æ–°æ¥å£ (`/api/watermark`)
- **è¯·æ±‚æ–¹å¼**: GET
- **å‚æ•°**: é€šè¿‡æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ é€’ï¼ŒåŒ…å« recordId
- **å¤„ç†æ–¹å¼**: å¤„ç†å®Œæˆåä¿å­˜åˆ° R2 å­˜å‚¨
- **é€‚ç”¨åœºæ™¯**: åŸºäºæ•°æ®åº“è®°å½•çš„æ°´å°å¤„ç†ï¼Œç»“æœæŒä¹…åŒ–å­˜å‚¨
- **è¿”å›ç»“æœ**: JSON å“åº”ï¼ŒåŒ…å«æ°´å°è§†é¢‘çš„ R2 é“¾æ¥

## âš ï¸ æ³¨æ„äº‹é¡¹

- Vercel è¯·æ±‚ä½“é™åˆ¶ä¸º 4.5MBï¼Œå¤§æ–‡ä»¶éœ€è¦é€šè¿‡å®¢æˆ·ç«¯ä¸Šä¼ 
- è§†é¢‘å¤„ç†éœ€è¦ FFmpeg æ”¯æŒï¼Œå·²é€šè¿‡ ffmpeg-static åŒ…æä¾›
- ç¡®ä¿ Cloudflare R2 å’Œ Supabase é…ç½®æ­£ç¡®
- æ°´å°å›¾ç‰‡éœ€è¦é¢„å…ˆä¸Šä¼ åˆ° R2 å­˜å‚¨çš„ `/images/watermark/` ç›®å½•

## ğŸš€ éƒ¨ç½²

é¡¹ç›®å·²é…ç½® Vercel éƒ¨ç½²ï¼Œæ”¯æŒè‡ªåŠ¨éƒ¨ç½²å’Œè¾¹ç¼˜å‡½æ•°ã€‚

## ï¿½ï¿½ è®¸å¯è¯

MIT License
