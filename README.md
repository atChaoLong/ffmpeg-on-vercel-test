# è§†é¢‘æ°´å°æ·»åŠ å·¥å…·

è¿™æ˜¯ä¸€ä¸ªåŸºäº Next.js å’Œ FFmpeg çš„è§†é¢‘æ°´å°æ·»åŠ å·¥å…·ï¼Œæ”¯æŒä¸Šä¼ è§†é¢‘åˆ° Cloudflare R2 å­˜å‚¨å¹¶æ·»åŠ è‡ªå®šä¹‰æ°´å°ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¥ æ”¯æŒå¤šç§è§†é¢‘æ ¼å¼ä¸Šä¼ ï¼ˆMP4, WebM, AVI ç­‰ï¼‰
- ğŸ–¼ï¸ 7ç§é¢„è®¾æ°´å°å›¾ç‰‡å¯é€‰
- ğŸ“ 5ç§æ°´å°ä½ç½®è®¾ç½®ï¼ˆå·¦ä¸Šè§’ã€å³ä¸Šè§’ã€å·¦ä¸‹è§’ã€å³ä¸‹è§’ã€ä¸­å¿ƒï¼‰
- ğŸ›ï¸ å¯è°ƒèŠ‚æ°´å°é€æ˜åº¦å’Œç¼©æ”¾æ¯”ä¾‹
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- âš¡ å®æ—¶å¤„ç†çŠ¶æ€æ˜¾ç¤º
- ğŸ’¾ è‡ªåŠ¨ä¿å­˜åˆ° Cloudflare R2 å’Œ Supabase

## æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Next.js 15, React 19, TypeScript, Tailwind CSS
- **åç«¯**: Next.js API Routes
- **è§†é¢‘å¤„ç†**: FFmpeg
- **å­˜å‚¨**: Cloudflare R2 (S3 å…¼å®¹)
- **æ•°æ®åº“**: Supabase (PostgreSQL)
- **éƒ¨ç½²**: Vercel

## ç¯å¢ƒé…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```bash
# Cloudflare R2 é…ç½®
CLOUDFLARE_R2_ACCESS_KEY_ID=your_access_key_id
CLOUDFLARE_R2_SECRET_ACCESS_KEY=your_secret_access_key
CLOUDFLARE_R2_BUCKET_NAME=your_bucket_name
CLOUDFLARE_R2_ACCOUNT_ID=your_account_id

# Supabase é…ç½®
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
```

## æ•°æ®åº“è¡¨ç»“æ„

```sql
create table public.ffmpeg_on_vercel_test (
  id bigint generated by default as identity not null,
  video_url text null,
  watermark_video_url text null,
  created_at timestamp with time zone not null default now(),
  updated_at timestamp with time zone null default now(),
  watermark_url text null,
  status text null,
  error_message text null,
  constraint ffmpeg_on_vercel_test_pkey primary key (id)
) TABLESPACE pg_default;
```

## å®‰è£…å’Œè¿è¡Œ

1. å®‰è£…ä¾èµ–ï¼š
```bash
npm install
```

2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆè§ä¸Šæ–¹ç¯å¢ƒé…ç½®ï¼‰

3. è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼š
```bash
npm run dev
```

4. æ„å»ºç”Ÿäº§ç‰ˆæœ¬ï¼š
```bash
npm run build
npm start
```

## ä½¿ç”¨æµç¨‹

1. **ä¸Šä¼ è§†é¢‘**: ç‚¹å‡»"é€‰æ‹©è§†é¢‘æ–‡ä»¶"æŒ‰é’®ï¼Œé€‰æ‹©è¦å¤„ç†çš„è§†é¢‘æ–‡ä»¶
2. **é…ç½®æ°´å°**: 
   - é€‰æ‹©æ°´å°å›¾ç‰‡ï¼ˆ7ç§é¢„è®¾å¯é€‰ï¼‰
   - è®¾ç½®æ°´å°ä½ç½®
   - è°ƒæ•´é€æ˜åº¦å’Œç¼©æ”¾æ¯”ä¾‹
   - é€‰æ‹©è¾“å‡ºæ ¼å¼ï¼ˆMP4 æˆ– WebMï¼‰
3. **æ·»åŠ æ°´å°**: ç‚¹å‡»"æ·»åŠ æ°´å°"æŒ‰é’®å¼€å§‹å¤„ç†
4. **æŸ¥çœ‹ç»“æœ**: å¤„ç†å®Œæˆåå¯ä»¥é¢„è§ˆå’Œä¸‹è½½å¸¦æ°´å°çš„è§†é¢‘

## API æ¥å£

### è§†é¢‘ä¸Šä¼ 
- **POST** `/api/video/upload`
- ä¸Šä¼ è§†é¢‘æ–‡ä»¶åˆ° Cloudflare R2

### æ°´å°å¤„ç†
- **POST** `/api/video/watermark`
- ä¸ºæŒ‡å®šè§†é¢‘æ·»åŠ æ°´å°

### çŠ¶æ€æŸ¥è¯¢
- **GET** `/api/video/status?videoId={id}`
- æŸ¥è¯¢è§†é¢‘å¤„ç†çŠ¶æ€

## æ°´å°å›¾ç‰‡

é¡¹ç›®åŒ…å«ä»¥ä¸‹é¢„è®¾æ°´å°å›¾ç‰‡ï¼š
- `kling.png` - Kling
- `luma.png` - Luma
- `pika.png` - Pika
- `runway.png` - Runway
- `stability.png` - Stability
- `veo.png` - Veo
- `vidu.png` - Vidu

## éƒ¨ç½²åˆ° Vercel

1. å°†ä»£ç æ¨é€åˆ° GitHub
2. åœ¨ Vercel ä¸­å¯¼å…¥é¡¹ç›®
3. é…ç½®ç¯å¢ƒå˜é‡
4. éƒ¨ç½²

## æ³¨æ„äº‹é¡¹

- è§†é¢‘æ–‡ä»¶å¤§å°é™åˆ¶ï¼š100MB
- æ”¯æŒçš„è§†é¢‘æ ¼å¼ï¼šæ‰€æœ‰ FFmpeg æ”¯æŒçš„æ ¼å¼
- å¤„ç†æ—¶é—´å–å†³äºè§†é¢‘é•¿åº¦å’Œå¤æ‚åº¦
- ç¡®ä¿ Cloudflare R2 å’Œ Supabase é…ç½®æ­£ç¡®

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **FFmpeg é”™è¯¯**: æ£€æŸ¥ `ffmpeg-static` æ˜¯å¦æ­£ç¡®å®‰è£…
2. **ä¸Šä¼ å¤±è´¥**: æ£€æŸ¥ Cloudflare R2 é…ç½®å’Œæƒé™
3. **æ•°æ®åº“é”™è¯¯**: æ£€æŸ¥ Supabase è¿æ¥å’Œè¡¨ç»“æ„
4. **æ°´å°å¤„ç†å¤±è´¥**: æ£€æŸ¥è§†é¢‘æ ¼å¼æ˜¯å¦æ”¯æŒ

### æ—¥å¿—æŸ¥çœ‹

åœ¨ Vercel éƒ¨ç½²ä¸­ï¼Œå¯ä»¥é€šè¿‡ Vercel ä»ªè¡¨æ¿æŸ¥çœ‹å‡½æ•°æ—¥å¿—æ¥è°ƒè¯•é—®é¢˜ã€‚

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
